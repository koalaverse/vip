<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Claude Development Guide for vip Package • vip</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Claude Development Guide for vip Package"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">vip</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/vip.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/koalaverse/vip/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Claude Development Guide for vip Package</h1>
      <small class="dont-index">Source: <a href="https://github.com/koalaverse/vip/blob/main/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claude-development-guide-for-vip-package" class="section level1">

<div class="section level2">
<h2 id="project-overview">Project Overview<a class="anchor" aria-label="anchor" href="#project-overview"></a></h2>
<p>The <strong>vip</strong> (Variable Importance Plots) package is a comprehensive R framework for constructing variable importance plots from various machine learning models. It provides both model-specific and model-agnostic approaches to feature importance, serving as a critical tool for interpretable machine learning (IML).</p>
<div class="section level3">
<h3 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a></h3>
<ul><li>
<strong>Unified Interface</strong>: Single API (<code><a href="reference/vi.html">vi()</a></code> and <code><a href="reference/vip.html">vip()</a></code>) for 40+ different ML model types</li>
<li>
<strong>Multiple VI Methods</strong>: Model-specific, permutation-based, SHAP-based, and variance-based approaches</li>
<li>
<strong>Extensive Model Support</strong>: Integration with major R ML ecosystems (tidymodels, caret, mlr, etc.)</li>
<li>
<strong>Professional Visualization</strong>: ggplot2-based plotting with customizable aesthetics</li>
<li>
<strong>Academic Rigor</strong>: Peer-reviewed methodology published in The R Journal (2020)</li>
</ul></div>
<div class="section level3">
<h3 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h3>
<pre><code>vip/
├── R/                          # Source code (12 files, ~3,735 lines)
│   ├── vi.R                   # Main VI computation interface
│   ├── vip.R                  # Main plotting interface
│   ├── vi_model.R             # Model-specific methods (42 S3 methods)
│   ├── vi_permute.R           # Permutation-based importance
│   ├── vi_shap.R              # Shapley-based importance
│   ├── vi_firm.R              # Variance-based importance
│   └── ...                    # Utilities and helpers
├── inst/tinytest/             # Test suite (28 files, ~1,581 lines)
├── man/                       # Documentation (11 .Rd files)
├── vignettes/                 # Package vignette
└── data/                      # Example datasets</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="development-workflow">Development Workflow<a class="anchor" aria-label="anchor" href="#development-workflow"></a></h2>
<div class="section level3">
<h3 id="test-driven-development-tdd-framework">Test-Driven Development (TDD) Framework<a class="anchor" aria-label="anchor" href="#test-driven-development-tdd-framework"></a></h3>
<p>This project follows <strong>strict test-driven development</strong> using the <code>tinytest</code> framework, chosen for its: - <strong>Zero dependencies</strong>: Lightweight testing without external deps - <strong>CRAN compatibility</strong>: Seamless integration with R package ecosystem - <strong>Conditional testing</strong>: Graceful handling of optional dependencies - <strong>Clear output</strong>: Simple, readable test results</p>
<div class="section level4">
<h4 id="tdd-cycle-for-vip-development">TDD Cycle for vip Development<a class="anchor" aria-label="anchor" href="#tdd-cycle-for-vip-development"></a></h4>
<ol style="list-style-type: decimal"><li>
<p><strong>Write Tests First</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Adding new model support</span></span>
<span><span class="co"># File: inst/tinytest/test_pkg_newmodel.R</span></span>
<span></span>
<span><span class="co"># Check dependencies first</span></span>
<span><span class="fu">exit_if_not</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"newmodel"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load test data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"test_dataset"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit model</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">newmodel</span><span class="fu">::</span><span class="fu">fit_model</span><span class="op">(</span><span class="va">target</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">test_dataset</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test vi() method</span></span>
<span><span class="va">vi_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vi.html">vi</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="fu">expect_inherits</span><span class="op">(</span><span class="va">vi_scores</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vi"</span>, <span class="st">"tbl_df"</span>, <span class="st">"tbl"</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">expect_equal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vi_scores</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">test_dataset</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span></span>
<span><span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Importance"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vi_scores</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Implement S3 Methods</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: R/vi_model.R</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">vi_model.newmodel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Extract importance scores</span></span>
<span>  <span class="va">importance</span> <span class="op">&lt;-</span> <span class="fu">newmodel</span><span class="fu">::</span><span class="fu">variable_importance</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Convert to standard format</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    Variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">importance</span><span class="op">)</span>,</span>
<span>    Importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">importance</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</li>
<li>
<p><strong>Run Tests and Refactor</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run specific tests</span></span>
<span><span class="fu">tinytest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tinytest/man/run_test_file.html" class="external-link">run_test_file</a></span><span class="op">(</span><span class="st">"inst/tinytest/test_pkg_newmodel.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run full suite</span></span>
<span><span class="fu">tinytest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tinytest/man/test_package.html" class="external-link">test_package</a></span><span class="op">(</span><span class="st">"vip"</span><span class="op">)</span></span></code></pre></div>
</li>
</ol></div>
</div>
<div class="section level3">
<h3 id="core-testing-patterns">Core Testing Patterns<a class="anchor" aria-label="anchor" href="#core-testing-patterns"></a></h3>
<div class="section level4">
<h4 id="id_1-conditional-testing-for-optional-dependencies">1. Conditional Testing for Optional Dependencies<a class="anchor" aria-label="anchor" href="#id_1-conditional-testing-for-optional-dependencies"></a></h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Always check dependencies before running tests</span></span>
<span><span class="fu">exit_if_not</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"randomForest"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"pdp"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="id_2-standardized-test-structure">2. Standardized Test Structure<a class="anchor" aria-label="anchor" href="#id_2-standardized-test-structure"></a></h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standard expectation function for VI objects</span></span>
<span><span class="va">expectations</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">n_features</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check class</span></span>
<span>  <span class="fu">expect_identical</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, </span>
<span>                   target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vi"</span>, <span class="st">"tbl_df"</span>, <span class="st">"tbl"</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Check dimensions</span></span>
<span>  <span class="fu">expect_identical</span><span class="op">(</span><span class="va">n_features</span>, target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Check required columns</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Importance"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Check for valid importance scores</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">object</span><span class="op">$</span><span class="va">Importance</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">object</span><span class="op">$</span><span class="va">Importance</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="id_3-model-specific-test-patterns">3. Model-Specific Test Patterns<a class="anchor" aria-label="anchor" href="#id_3-model-specific-test-patterns"></a></h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pattern for testing model-specific implementations</span></span>
<span><span class="va">test_model_vi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">expected_features</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Test basic vi() call</span></span>
<span>  <span class="va">vi_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vi.html">vi</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span>  <span class="fu">expectations</span><span class="op">(</span><span class="va">vi_result</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">expected_features</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Test with different methods</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">method</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"permute"</span>, <span class="st">"shap"</span>, <span class="st">"firm"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu">supports_method</span><span class="op">(</span><span class="va">model</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">vi_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vi.html">vi</a></span><span class="op">(</span><span class="va">model</span>, method <span class="op">=</span> <span class="va">method</span><span class="op">)</span></span>
<span>      <span class="fu">expectations</span><span class="op">(</span><span class="va">vi_method</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">expected_features</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Test vip() plotting</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vip.html">vip</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span>  <span class="fu">expect_inherits</span><span class="op">(</span><span class="va">p</span>, <span class="st">"ggplot"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="r-best-practices-implementation">R Best Practices Implementation<a class="anchor" aria-label="anchor" href="#r-best-practices-implementation"></a></h2>
<div class="section level3">
<h3 id="id_1-package-structure">1. Package Structure<a class="anchor" aria-label="anchor" href="#id_1-package-structure"></a></h3>
<ul><li>
<strong>DESCRIPTION</strong>: Proper metadata, versioning, and dependency management</li>
<li>
<strong>NAMESPACE</strong>: Clean exports using roxygen2 <code>@export</code> tags</li>
<li>
<strong>Imports</strong>: Minimal dependencies (5 core imports)</li>
<li>
<strong>S3 Methods</strong>: Consistent dispatch system for 40+ model types</li>
</ul></div>
<div class="section level3">
<h3 id="id_2-code-style-and-documentation">2. Code Style and Documentation<a class="anchor" aria-label="anchor" href="#id_2-code-style-and-documentation"></a></h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Roxygen2 documentation standard</span></span>
<span><span class="co">#' Variable importance</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Compute variable importance scores for the predictors in a model.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param object A fitted model object</span></span>
<span><span class="co">#' @param method Character string specifying VI type ("model", "permute", "shap", "firm")</span></span>
<span><span class="co">#' @param feature_names Character vector of feature names to compute</span></span>
<span><span class="co">#' @param sort Logical indicating whether to sort results</span></span>
<span><span class="co">#' @param ... Additional arguments passed to specific methods</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A tibble with Variable and Importance columns</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#' library(randomForest)</span></span>
<span><span class="co">#' rf &lt;- randomForest(Species ~ ., data = iris)</span></span>
<span><span class="co">#' vi_scores &lt;- vi(rf)</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">vi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"vi"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_3-error-handling-and-validation">3. Error Handling and Validation<a class="anchor" aria-label="anchor" href="#id_3-error-handling-and-validation"></a></h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Input validation pattern</span></span>
<span><span class="va">vi_validate_inputs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">method</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check object class</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"list"</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.function.html" class="external-link">is.function</a></span><span class="op">(</span><span class="va">predict</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'object' must be a fitted model with a predict method"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Validate method</span></span>
<span>  <span class="va">valid_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"permute"</span>, <span class="st">"shap"</span>, <span class="st">"firm"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">method</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valid_methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'method' must be one of: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">valid_methods</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_4-performance-considerations">4. Performance Considerations<a class="anchor" aria-label="anchor" href="#id_4-performance-considerations"></a></h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Efficient parallel processing with foreach</span></span>
<span><span class="va">vi_permute_parallel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">train</span>, <span class="va">metric</span>, <span class="va">nsim</span>, <span class="va">parallel</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">parallel</span> <span class="op">&amp;&amp;</span> <span class="fu">foreach</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/foreach/man/getDoParWorkers.html" class="external-link">getDoParRegistered</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nsim</span><span class="op">)</span>, .combine <span class="op">=</span> <span class="va">rbind</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span></span>
<span>      <span class="fu">compute_permutation_importance</span><span class="op">(</span><span class="va">object</span>, <span class="va">train</span>, <span class="va">metric</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nsim</span><span class="op">)</span>, .combine <span class="op">=</span> <span class="va">rbind</span><span class="op">)</span> <span class="op">%do%</span> <span class="op">{</span></span>
<span>      <span class="fu">compute_permutation_importance</span><span class="op">(</span><span class="va">object</span>, <span class="va">train</span>, <span class="va">metric</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">results</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_5-ggplot2-compatibility-important">5. ggplot2 Compatibility (Important!)<a class="anchor" aria-label="anchor" href="#id_5-ggplot2-compatibility-important"></a></h3>
<p>With ggplot2’s transition to S7 classes, testing ggplot object classes requires updated approaches:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ❌ DEPRECATED: Direct class testing (will break with ggplot2 S7)</span></span>
<span><span class="fu">expect_identical</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gg"</span>, <span class="st">"ggplot"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ✅ RECOMMENDED: Use is_ggplot() for forward compatibility</span></span>
<span><span class="fu">expect_true</span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/is_tests.html" class="external-link">is_ggplot</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Alternative approaches:</span></span>
<span><span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"ggplot"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># fallback option</span></span></code></pre></div>
<p><strong>Key Points:</strong> - Always use <code><a href="https://ggplot2.tidyverse.org/reference/is_tests.html" class="external-link">ggplot2::is_ggplot()</a></code> rather than <code><a href="https://rdrr.io/r/base/class.html" class="external-link">class()</a></code> for ggplot objects in tests - This ensures compatibility with both current and future ggplot2 versions - Updated in vip 0.4.1 to address <a href="https://github.com/koalaverse/vip/issues/162" class="external-link">issue #162</a></p>
</div>
<div class="section level3">
<h3 id="id_6-documentation-and-readme-style-guidelines">6. Documentation and README Style Guidelines<a class="anchor" aria-label="anchor" href="#id_6-documentation-and-readme-style-guidelines"></a></h3>
<p><strong>Sentence Case Requirements:</strong> - <strong>ALWAYS use sentence case</strong> for all headings, bullet points, and descriptions - Examples: - ✅ “Key features” (not “Key Features”)<br>
- ✅ “Model-specific variable importance” (not “Model-Specific Variable Importance”) - ✅ “Adding model support” (not “Adding Model Support”)</p>
<p><strong>Emoji Usage Guidelines:</strong> - <strong>Section headers</strong>: Emojis are encouraged (🚀, ✨, 🛠️, etc.) - <strong>Tables and content</strong>: Use sparingly, only when they add clear value - <strong>Lists and bullets</strong>: Avoid emojis in favor of clean, readable text - <strong>General rule</strong>: When in doubt, leave it out</p>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu"># ✅ GOOD</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">## 🚀 Quick start</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="ss">- </span>**Universal interface**: Works with 40+ model types</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="ss">- </span>**Multiple methods**: Model-specific, permutation, SHAP</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="fu"># ❌ AVOID</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="fu">## 🚀 Quick Start  # Title case</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="ss">- </span>**🎯 Universal Interface**: Works with 40+ model types  # Emoji in bullet + title case</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="ss">- </span>**🔬 Multiple Methods**: Model-specific, permutation, SHAP  # Same issues</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="development-commands">Development Commands<a class="anchor" aria-label="anchor" href="#development-commands"></a></h2>
<div class="section level3">
<h3 id="essential-r-cmd-commands">Essential R CMD Commands<a class="anchor" aria-label="anchor" href="#essential-r-cmd-commands"></a></h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Check package</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">R</span> CMD check vip_<span class="pp">*</span>.tar.gz <span class="at">--as-cran</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co"># Build package</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="ex">R</span> CMD build .</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># Install package</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="ex">R</span> CMD INSTALL .</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co"># Generate documentation</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"roxygen2::roxygenise()"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing-commands">Testing Commands<a class="anchor" aria-label="anchor" href="#testing-commands"></a></h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Run all tests</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>tinytest<span class="sc">::</span><span class="fu">test_package</span>(<span class="st">"vip"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># Run specific test file</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>tinytest<span class="sc">::</span><span class="fu">run_test_file</span>(<span class="st">"inst/tinytest/test_vi_firm.R"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># Test with coverage</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>covr<span class="sc">::</span><span class="fu">package_coverage</span>()</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co"># Test examples in documentation</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>R CMD check <span class="sc">--</span>run<span class="sc">-</span>donttest <span class="sc">--</span>run<span class="sc">-</span>dontrun</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="linting-and-style">Linting and Style<a class="anchor" aria-label="anchor" href="#linting-and-style"></a></h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check code style</span></span>
<span><span class="fu">lintr</span><span class="fu">::</span><span class="fu">lint_package</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Format code (if using styler)</span></span>
<span><span class="fu">styler</span><span class="fu">::</span><span class="fu">style_pkg</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="adding-new-model-support">Adding New Model Support<a class="anchor" aria-label="anchor" href="#adding-new-model-support"></a></h2>
<div class="section level3">
<h3 id="step-by-step-tdd-process">Step-by-Step TDD Process<a class="anchor" aria-label="anchor" href="#step-by-step-tdd-process"></a></h3>
<ol style="list-style-type: decimal"><li>
<p><strong>Create Test File</strong></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: inst/tinytest/test_pkg_NEWMODEL.R</span></span>
<span><span class="fu">exit_if_not</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"NEWMODEL"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load test data and fit model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"test_data"</span><span class="op">)</span>  <span class="co"># or create synthetic data</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">NEWMODEL</span><span class="fu">::</span><span class="fu">fit_function</span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define expectations</span></span>
<span><span class="va">expectations</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">expect_inherits</span><span class="op">(</span><span class="va">object</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vi"</span>, <span class="st">"tbl_df"</span>, <span class="st">"tbl"</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Importance"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test vi_model method</span></span>
<span><span class="va">vi_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vi.html">vi</a></span><span class="op">(</span><span class="va">model</span>, method <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span></span>
<span><span class="fu">expectations</span><span class="op">(</span><span class="va">vi_result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test vip plotting</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vip.html">vip</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="fu">expect_inherits</span><span class="op">(</span><span class="va">p</span>, <span class="st">"ggplot"</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Implement S3 Method</strong></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: R/vi_model.R</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">vi_model.NEWMODEL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">type</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Extract variable importance</span></span>
<span>  <span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">NEWMODEL</span><span class="fu">::</span><span class="fu">importance_function</span><span class="op">(</span><span class="va">object</span>, type <span class="op">=</span> <span class="va">type</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Convert to standard tibble format</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    Variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span>,</span>
<span>    Importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</li>
<li>
<p><strong>Update Documentation</strong></p>
<ul><li>Add to <code>vi_model.R</code> details section</li>
<li>Update DESCRIPTION Enhances field if needed</li>
<li>Add example to package vignette</li>
</ul></li>
<li>
<p><strong>Run Tests</strong></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test new implementation</span></span>
<span><span class="fu">tinytest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tinytest/man/run_test_file.html" class="external-link">run_test_file</a></span><span class="op">(</span><span class="st">"inst/tinytest/test_pkg_NEWMODEL.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run full test suite</span></span>
<span><span class="fu">tinytest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tinytest/man/test_package.html" class="external-link">test_package</a></span><span class="op">(</span><span class="st">"vip"</span><span class="op">)</span></span></code></pre></div>
</li>
</ol></div>
</div>
<div class="section level2">
<h2 id="quality-assurance-checklist">Quality Assurance Checklist<a class="anchor" aria-label="anchor" href="#quality-assurance-checklist"></a></h2>
<div class="section level3">
<h3 id="before-committing">Before Committing<a class="anchor" aria-label="anchor" href="#before-committing"></a></h3>
<ul class="task-list"><li><label><input type="checkbox">All tests pass: <code>tinytest::test_package("vip")</code></label></li>
<li><label><input type="checkbox">Documentation builds: <code>roxygen2::roxygenise()</code></label></li>
<li><label><input type="checkbox">Examples run: <code>R CMD check --run-donttest</code></label></li>
<li><label><input type="checkbox">Code style consistent: <code>lintr::lint_package()</code></label></li>
<li><label><input type="checkbox">News file updated for user-facing changes</label></li>
</ul></div>
<div class="section level3">
<h3 id="before-release">Before Release<a class="anchor" aria-label="anchor" href="#before-release"></a></h3>
<ul class="task-list"><li><label><input type="checkbox">Version number updated in DESCRIPTION</label></li>
<li><label><input type="checkbox">NEWS.md updated with changes</label></li>
<li><label><input type="checkbox">All suggested packages tested</label></li>
<li><label><input type="checkbox">CRAN checks pass: <code>R CMD check --as-cran</code></label></li>
<li><label><input type="checkbox">Reverse dependency checks completed</label></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="known-technical-debt">Known Technical Debt<a class="anchor" aria-label="anchor" href="#known-technical-debt"></a></h2>
<p>Current FIXME items to address: 1. <code>get_feature_names.R:58</code> - Component location verification 2. <code>vi_model.R:588,615,642</code> - Extra row handling in model outputs<br>
3. <code>vi_permute.R:443</code> - Yardstick integration optimization</p>
</div>
<div class="section level2">
<h2 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a></h2>
<ul><li>
<strong>Package Website</strong>: <a href="https://koalaverse.github.io/vip/" class="uri">https://koalaverse.github.io/vip/</a>
</li>
<li>
<strong>CRAN Page</strong>: <a href="https://cran.r-project.org/package=vip" class="external-link uri">https://cran.r-project.org/package=vip</a>
</li>
<li>
<strong>GitHub Repository</strong>: <a href="https://github.com/koalaverse/vip/" class="external-link uri">https://github.com/koalaverse/vip/</a>
</li>
<li>
<strong>R Journal Paper</strong>: <a href="https://doi.org/10.32614/RJ-2020-013" class="external-link uri">https://doi.org/10.32614/RJ-2020-013</a>
</li>
<li>
<strong>tinytest Documentation</strong>: <a href="https://cran.r-project.org/package=tinytest" class="external-link uri">https://cran.r-project.org/package=tinytest</a>
</li>
</ul><hr><p>This guide ensures consistent, high-quality development following R package best practices and test-driven development methodology.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brandon M. Greenwell, Brad Boehmke.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

